<html>
<head>
<title>cool2js</title>
<style>
body{
  margin:0px;
  padding:0px;
  background-color:blue;
  font-family:'Courier New';
}
textarea{
  background-color:black;
  color:white;
  border:0px;
}
label {
  font-weight:bold;
  color:white;
}
</style>
<script src="js/cool.js" ></script>
<script src="js/datastruct.js" ></script>
<script src="js/semant.js" ></script>
<script>
function getXHR(){
      if (window.XMLHttpRequest)
  {// code for IE7+, Firefox, Chrome, Opera, Safari
  return new XMLHttpRequest();
  }
else
  {// code for IE6, IE5
  return new ActiveXObject("Microsoft.XMLHTTP");
  }
}
function doxhr(url,cb){
   var xhr = getXHR();
  xhr.open("GET",url,true);
  xhr.onreadystatechange=function()
  {
  if (xhr.readyState==4 && xhr.status==200)
    {
        cb(xhr.responseText);
    }
  }
   xhr.send();
}
function getSourceCode(){
     var select_v = document.getElementById('srcselect');
	 return "examples/"+select_v.value+".cl";
}
function getSourceInput(){
     var select_v = document.getElementById('srcselect');
	 return "examples/input/"+select_v.value+".txt";
}
function processResponse(src){
    var srccddiv = document.getElementById("srccd");
	srccddiv.value=src;
	   var inptdiv = document.getElementById("inpt");
	   inptdiv.value="";//clean up
	   doxhr(getSourceInput(),function(v){
	        inptdiv.value=v;
	   });
}
function loadSource(){
   doxhr(getSourceCode(),processResponse);  
   
}
function runit(){
   tptr=0;
  var srccddiv = document.getElementById("srccd");
   var inptdiv = document.getElementById("inpt");
   var outptdiv = document.getElementById("outpt");
   var dbgv = document.getElementById("dbgwin");
    outptdiv.value="";
	dbgv.value="";
	//inptdiv.value="";
	var parser = new cool.Parser();
	parser.yy.ds = ds;
	parser.yy.sa = sa;
	parser.yy.debug = function(v){
	  dbgv.style.color='white';
	  dbgv.value+=v;
	};
	var strs = inptdiv.value.split(" ");
	var next=0;
	parser.yy.printstr=function(str){
	    outptdiv.value+=str;
	}
	parser.yy.readstr=function(){
	    return strs[next++];
	}
	try{
	dbgv.style.color='white';
	dbgv.value+="Starting....\n";
	parser.parse(srccddiv.value);
	} catch(e){
	    dbgv.style.color='red';
	    dbgv.value=e.message;
		throw new Error("Terminated Abnormally");
	}
	dbgv.style.color='white';
	dbgv.value+="\nExecution completed successfully\n";
	dbgv.scrollTop = dbgv.scrollHeight;

}
</script>
</head>
<body >
<h2 style="background-color:blue;border:1px white solid;padding:0px;margin:0px;color:white;">COOL2JS compiler</h2>
<br/>
<table>
<tr>
<td>
<label>Source:</label><select id="srcselect" onchange="loadSource()">
<option value="hello_world">Hello World</option>
<option value="cool">Cool</option>
<option value="palindrome">Palindrome</option>
<option value="random">Random</option>
<option value="fibonacci">Fibonacci Sequence</option>
<option value="factorial">Factorial</option>
</select>
</td><td><label>Output:</label></td>
</tr>
<tr>
<td>
<textarea style="display:block;" rows="20" cols="60" id="srccd" >
</textarea>
</td>
<td>

<textarea rows="20" cols="60" id="outpt" ></textarea>
</td></tr>
<tr>
<tr>
<td><label>Input:</label></td><td><label>Compiler Log:</label>	</td>
</tr>
<td>

<textarea rows="10" cols="60" id="inpt" ></textarea>
</td>
<td>

<textarea rows="10" cols="60" id="dbgwin" ></textarea>
</td>
</tr>
<tr>
<td>
<input type="button" value="Execute" onclick="runit()" />
</td>
</tr>
</table>
<script>
loadSource();
</script>
</body>
</html>